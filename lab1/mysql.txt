drop table recommends;
drop table subtopic;
drop table expert_within;
drop table topic;
drop table expert;

create table expert
(
id integer primary key,
name varchar(50),
email varchar(50),
description varchar(50)
);

create table topic
(
 id integer primary key,
 name varchar(50),
 originator integer not null, 
 description varchar(50),
 foreign key (originator) references expert(id)
);

create table subtopic
(
	supertopic integer,
	subtopic integer,
	primary key (supertopic, subtopic),
	foreign key (supertopic) references topic(id),
	foreign key (subtopic) references topic(id)
);

create table expert_within
(
	expert integer,
	topic integer,
	primary key (expert, topic),
	foreign key (expert) references expert(id),
	foreign key (topic) references topic(id)
);

create table recommends
(
	id integer identity(1,1) primary key,
	from_expert integer not null,
	to_expert integer not null,
	justification varchar(50),
	foreign key (from_expert) references expert(id),
	foreign key (to_expert) references expert(id)
);

insert into expert (id, name, email, description) values (1, 'Mr. Smith', 'Smith@sunet.se', 'A geologist');
insert into expert (id, name, email, description) values (2, 'Clark ´Kent', 'C.Kent@DailyMail.co.uk', 'Works with rays');
insert into expert (id, name, email, description) values (3, 'Maxwell', 'Maxx@gmail.com', 'Magnets and stuff');

insert into topic (id, name, originator, description) values (1, 'Geology', 1, 'Study of rocks'); 
insert into topic (id, name, originator, description) values (2, 'Advanced Geology', 1 , 'Study of advanced rocks');
insert into topic (id, name, originator, description) values (3, 'Pysics', 2, 'Forces and matter');
insert into topic (id, name, originator, description) values (4, 'Electricity', 3, 'Bzzz');

insert into subtopic (supertopic, subtopic) values (1,2);
insert into subtopic (supertopic, subtopic) values (3,4);

insert into expert_within (expert, topic) values (1,1);
insert into expert_within (expert, topic) values (1,2);
insert into expert_within (expert, topic) values (3,1);
insert into expert_within (expert, topic) values (3,4);
insert into expert_within (expert, topic) values (2,3);

insert into recommends (from_expert, to_expert, justification) values (3,1, 'Study advanced geology');
insert into recommends (from_expert, to_expert, justification) values (1,3, 'Drop study geology');
insert into recommends (from_expert, to_expert, justification) values (3,2, 'Start with Bzzz');


select * from expert;
select name from topic where originator = 1;
select expert from expert_within where topic = 1;
select expert.name from expert,expert_within where expert_within.topic = 1 and expert_within.expert = expert.id;
select topic.name from topic,subtopic where subtopic.supertopic = 1 and topic.id = subtopic.subtopic;

select recommends.to_expert from recommends where recommends.from_expert = 1 and recommends.to_expert in (select expert from expert_within where topic = 1);

select id=recommends.to_expert from recommends where recommends.from_expert in (select recommends.to_expert from recommends where recommends.from_expert = id) and recommends.to_expert in (select expert from expert_within where topic = 1);
